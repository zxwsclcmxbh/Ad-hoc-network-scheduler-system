(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3958d118"],{6178:function(e,t,n){"use strict";n("cd5a")},b815:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-steps",{attrs:{active:e.active,"finish-status":"success"}},[n("el-step",{attrs:{title:"填写基本信息"}}),n("el-step",{attrs:{title:"绘制编排流程图"}}),n("el-step",{attrs:{title:"编排结果"}})],1),1===e.active?n("div",[n("el-form",{attrs:{"label-width":"100px"},model:{value:e.task_desc,callback:function(t){e.task_desc=t},expression:"task_desc"}},[n("el-form-item",{attrs:{label:"项目名称"}},[n("el-input",{model:{value:e.task_desc.name,callback:function(t){e.$set(e.task_desc,"name",t)},expression:"task_desc.name"}})],1),n("el-form-item",{attrs:{label:"项目描述"}},[n("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入内容"},model:{value:e.task_desc.desc,callback:function(t){e.$set(e.task_desc,"desc",t)},expression:"task_desc.desc"}})],1),n("el-form-item",[n("el-button",{on:{click:e.next_step}},[e._v("下一步")])],1)],1)],1):2===e.active?n("el-card",[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("编排流程图")]),n("el-button",{staticStyle:{float:"right"},on:{click:e.exportJson}},[e._v("提交编排")]),n("el-button",{staticStyle:{float:"right"},on:{click:e.prev_step}},[e._v("上一步")])],1),n("div",{staticClass:"super-flow-base-demo"},[n("div",{staticClass:"node-container"},e._l(e.nodeItemList,(function(t){return n("span",{key:t.label,staticClass:"node-item",on:{mousedown:function(n){return e.nodeItemMouseDown(n,t.value)}}},[e._v(" "+e._s(t.label)+" ")])})),0),n("div",{ref:"flowContainer",staticClass:"flow"},[n("super-flow",{ref:"superFlow",attrs:{"has-mark-line":!1,"node-list":e.nodeList,"link-list":e.linkList,origin:e.origin,"graph-menu":e.graphMenuList,"node-menu":e.nodeMenuList,"link-menu":e.linkMenuList,"enter-intercept":e.enterIntercept,"output-intercept":e.outputIntercept},scopedSlots:e._u([{key:"node",fn:function(t){var a=t.meta,o=t.node;return[n("div",{class:"flow-node flow-node-"+e.nodesettings[a.id].prop,on:{dblclick:function(t){return e.openConfig(o)}}},[n("header",[e._v(" "+e._s(e.nodesettings[a.id].name)+" ")]),n("section",[e._v(" "+e._s(e.nodesettings[a.id].desc)+" ")])])]}}])})],1),n("el-drawer",{attrs:{title:"编辑节点属性",size:"40%",visible:e.drawer,direction:"rtl","before-close":e.handleClose},on:{"update:visible":function(t){e.drawer=t}}},[n("div",{staticStyle:{width:"100%",padding:"5px"}},[n("el-form",{attrs:{model:e.tmpdata,"label-width":"100px"}},[e._l(e.tmpschema,(function(t,a){return n("el-form-item",{key:a,attrs:{label:t.name}},["input"===t.type?n("div",[n("el-input",{attrs:{placeholder:t.placeholder},model:{value:e.tmpdata[a],callback:function(t){e.$set(e.tmpdata,a,t)},expression:"tmpdata[k]"}})],1):"model"===t.type?n("div",[n("el-col",{attrs:{span:14}},[n("el-input",{attrs:{placeholder:t.placeholder,disabled:!0},model:{value:e.tmpdata[a],callback:function(t){e.$set(e.tmpdata,a,t)},expression:"tmpdata[k]"}})],1),n("el-col",{attrs:{span:6}}),n("el-col",{attrs:{span:4}},[n("el-popover",{attrs:{placement:"bottom",title:"搜索镜像仓库",width:"900",trigger:"click"},model:{value:e.searchvisible,callback:function(t){e.searchvisible=t},expression:"searchvisible"}},[n("vue-simple-suggest",{attrs:{list:e.searchFunc,mode:"select"},on:{select:e.onSuggestSelect},scopedSlots:e._u([{key:"suggestion-item",fn:function(t){var a=t.suggestion;return n("div",{staticClass:"custom"},[e._v(e._s(a.title)+" ")])}}],null,!0),model:{value:e.searchchoice,callback:function(t){e.searchchoice=t},expression:"searchchoice"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.searchtext,expression:"searchtext"}],domProps:{value:e.searchtext},on:{input:function(t){t.target.composing||(e.searchtext=t.target.value)}}})]),n("el-button",{attrs:{slot:"reference"},slot:"reference"},[e._v("搜索")])],1)],1)],1):n("div",[n("el-select",{attrs:{placeholder:t.placeholder},model:{value:e.tmpdata[a],callback:function(t){e.$set(e.tmpdata,a,t)},expression:"tmpdata[k]"}},e._l(t.choices,(function(e){return n("el-option",{key:e.label,attrs:{label:e.label,value:e.val}})})),1)],1)])})),e.mapper_needed?n("div",e._l(e.tmp_mapper_info,(function(t){return n("el-form-item",{key:t.key,attrs:{label:t.name}},[n("el-col",{attrs:{span:10}},[n("el-select",{model:{value:e.tmpdata.mapper[t.key].type,callback:function(n){e.$set(e.tmpdata.mapper[t.key],"type",n)},expression:"tmpdata.mapper[item.key].type"}},e._l(t.options,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),n("el-col",{attrs:{span:2}}),"default"===e.tmpdata.mapper[t.key].type||"custom"===e.tmpdata.mapper[t.key].type?n("el-col",{attrs:{span:12}},[n("el-input",{model:{value:e.tmpdata.mapper[t.key].value,callback:function(n){e.$set(e.tmpdata.mapper[t.key],"value",n)},expression:"tmpdata.mapper[item.key].value"}})],1):e._e()],1)})),1):e._e(),e.isForceSelectEdgeNode?e._e():n("el-form-item",{attrs:{label:"节点编排"}},[n("el-button",{attrs:{type:"primary",plain:""},on:{click:e.nodeCombination}},[e._v("点击进行设置")]),n("el-drawer",{attrs:{title:"节点编排","append-to-body":!0,"before-close":e.innerHandleClose,visible:e.innerDrawer},on:{"update:visible":function(t){e.innerDrawer=t}}},[n("el-form-item",{attrs:{label:"选择端:"}},[n("el-radio",{attrs:{label:"cloud"},model:{value:e.tmpdata.nodeStrategy.nodeType,callback:function(t){e.$set(e.tmpdata.nodeStrategy,"nodeType",t)},expression:"tmpdata.nodeStrategy.nodeType"}},[e._v("云端")]),n("el-radio",{attrs:{label:"edge"},model:{value:e.tmpdata.nodeStrategy.nodeType,callback:function(t){e.$set(e.tmpdata.nodeStrategy,"nodeType",t)},expression:"tmpdata.nodeStrategy.nodeType"}},[e._v("边缘端")]),n("el-radio",{attrs:{label:"random"},model:{value:e.tmpdata.nodeStrategy.nodeType,callback:function(t){e.$set(e.tmpdata.nodeStrategy,"nodeType",t)},expression:"tmpdata.nodeStrategy.nodeType"}},[e._v("随机")])],1),"cloud"===e.tmpdata.nodeStrategy.nodeType?n("el-form-item",{attrs:{label:"GPU:"}},[n("el-switch",{attrs:{"active-text":"使用","inactive-text":"不使用"},model:{value:e.tmpdata.nodeStrategy.isGPU,callback:function(t){e.$set(e.tmpdata.nodeStrategy,"isGPU",t)},expression:"tmpdata.nodeStrategy.isGPU"}})],1):"edge"===e.tmpdata.nodeStrategy.nodeType?n("el-form-item",{attrs:{label:"厂区:"}},[n("el-select",{attrs:{placeholder:"请选择"},model:{value:e.tmpdata.nodeStrategy.nodeArea,callback:function(t){e.$set(e.tmpdata.nodeStrategy,"nodeArea",t)},expression:"tmpdata.nodeStrategy.nodeArea"}},e._l(e.area,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"random"!==e.tmpdata.nodeStrategy.nodeType&&"random"!==e.tmpdata.nodeStrategy.nodeArea?n("div",[n("el-form-item",{attrs:{label:"运行节点:"}},[n("el-switch",{attrs:{"active-text":"随机","inactive-text":"自选"},model:{value:e.tmpdata.nodeStrategy.isNodeRandom,callback:function(t){e.$set(e.tmpdata.nodeStrategy,"isNodeRandom",t)},expression:"tmpdata.nodeStrategy.isNodeRandom"}})],1),e.tmpdata.nodeStrategy.isNodeRandom?e._e():n("el-form-item",{attrs:{label:"运行节点:"}},[n("el-select",{attrs:{filterable:!0,clearable:""},model:{value:e.tmpdata.nodeStrategy.nodePrefer,callback:function(t){e.$set(e.tmpdata.nodeStrategy,"nodePrefer",t)},expression:"tmpdata.nodeStrategy.nodePrefer"}},e._l(e.nodeFilter(e.node_info,e.tmpdata.nodeStrategy.nodeType,e.tmpdata.nodeStrategy.nodeArea,e.tmpdata.nodeStrategy.isGPU),(function(t){return n("el-option",{key:t.key,attrs:{value:t.key}},[n("span",[e._v(e._s(t.key))]),e._l(t.tag,(function(t){return n("el-tag",{key:t,attrs:{size:"mini"}},[e._v(e._s(t))])})),n("i",{class:"iconfont icon-a-xinhaowangluo-"+t.status})],2)})),1)],1)],1):e._e(),n("el-form-item",{staticStyle:{"margin-left":"100px"}},[n("el-button",{on:{click:e.saveNodeCombination}},[e._v("确认")])],1)],1)],1),e.isForceSelectEdgeNode?n("el-form-item",{attrs:{label:"运行节点"}},[n("el-select",{attrs:{filterable:!0,clearable:""},model:{value:e.tmpdata.node,callback:function(t){e.$set(e.tmpdata,"node",t)},expression:"tmpdata.node"}},e._l(e.nodeTypeFilter(e.node_info,"边缘端"),(function(t){return n("el-option",{key:t.key,attrs:{value:t.key}},[n("span",[e._v(e._s(t.key))]),e._l(t.tag,(function(t){return n("el-tag",{key:t,attrs:{size:"mini"}},[e._v(e._s(t))])})),n("i",{class:"iconfont icon-a-xinhaowangluo-"+t.status})],2)})),1)],1):e._e(),n("el-form-item",[n("el-button",{on:{click:e.save}},[e._v("确认")])],1)],2)],1)])],1)]):n("div",[n("el-result",{attrs:{icon:"success",title:"部署成功","sub-title":"稍后可查看部署状态"}},[n("template",{slot:"extra"},[n("el-button",{attrs:{type:"primary",size:"medium"}},[e._v("返回")])],1)],2)],1)],1)},o=[],i=n("c7eb"),s=n("5530"),r=n("1da1"),l=(n("b0c0"),n("7db0"),n("d3b7"),n("e9c4"),n("159b"),n("b64b"),n("4de4"),n("caad"),n("bf19"),n("5111")),d=(n("c4c9"),n("b199")),c=n("3390"),p={components:{VueSimpleSuggest:l["a"]},data:function(){var e=this;return{tempNodeAffinity:{},active:1,dragConf:{isDown:!1,isMove:!1,offsetTop:0,offsetLeft:0,clientX:0,clientY:0,ele:null,info:null},searchvisible:!1,searchtext:"",searchchoice:"",nodesettings:{},node_info:{},area:[{value:"huadu",label:"花都工厂"},{value:"huangpu",label:"黄埔创新中心"},{value:"random",label:"随机"}],search:!1,mapper_needed:!1,origin:[681,465],nodeList:[],linkList:[],nodeData:{},task_desc:{name:"",desc:""},drawer:!1,innerDrawer:!1,isForceSelectEdgeNode:!1,tmpschema:{},tmpdata:{node:"",nodeStrategy:{isGPU:!1,nodeArea:"",isNodeRandom:!1,nodeType:"random",nodePrefer:""},nodeAffinity:""},tmpnodename:"",dialog:!1,importtext:"",nodeItemList:[],graphMenuList:[],mapper_info:{},tmp_mapper_info:[],nodeMenuList:[[{label:"编辑",selected:function(t,n){e.openConfig(t)}}],[{label:"删除",disable:!1,selected:function(e,t){e.remove()}}]],linkMenuList:[[{label:"删除",disable:!1,selected:function(e,t){e.remove()}}]]}},mounted:function(){var e=this;document.addEventListener("mousemove",this.docMousemove),document.addEventListener("mouseup",this.docMouseup),this.$once("hook:beforeDestroy",(function(){document.removeEventListener("mousemove",e.docMousemove),document.removeEventListener("mouseup",e.docMouseup)}))},created:function(){var e=this;return Object(r["a"])(Object(i["a"])().mark((function t(){var n,a,o,r,l,c;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(d["c"])();case 2:return n=t.sent,t.next=5,Object(d["d"])();case 5:return a=t.sent,e.nodesettings=n.data,e.mapper_info=a.data,t.next=10,Object(d["e"])();case 10:for(r in e.node_info=t.sent,console.log(e.node_info),o=function(t){l=e.nodesettings[t];var a={id:t},o={width:120,height:50,meta:a};c={},c="start"===l.prop?{meta:a,label:l.name,selected:function(e,t){e.addNode(Object(s["a"])(Object(s["a"])({},o),{},{coordinate:t}))}}:"output"===l.prop?{label:l.name,meta:a,disable:function(e){return!!e.nodeList.find((function(e){return"output"===n[e.meta.id].prop}))},selected:function(e,t){var a=e.nodeList.find((function(e){return"output"===n[e.meta.id].prop}));a||e.addNode(Object(s["a"])(Object(s["a"])({},o),{},{coordinate:t}))}}:{label:l.name,meta:a,disable:!1,selected:function(e,t){e.addNode(Object(s["a"])(Object(s["a"])({},o),{},{coordinate:t}))}},e.graphMenuList.push([c]),e.nodeItemList.push({label:l.name,value:function(){return o}})},e.nodesettings)o(r);case 14:case"end":return t.stop()}}),t)})))()},methods:{next_step:function(){this.active+=1},prev_step:function(){this.active-=1},onSuggestSelect:function(){console.log(this.searchchoice),this.tmpdata.model=this.searchchoice.image,console.log(JSON.stringify(this.tmpdata)),this.searchvisible=!1},searchFunc:function(){var e=this;return Object(r["a"])(Object(i["a"])().mark((function t(){var n;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log(e.searchtext),t.next=3,Object(d["n"])(e.searchtext);case 3:return n=t.sent,t.abrupt("return",n.data.data);case 5:case"end":return t.stop()}}),t)})))()},openImport:function(){this.dialog=!0},importJson:function(){var e=JSON.parse(this.importtext);this.nodeList=e.graph.nodeList,this.origin=e.graph.origin,this.linkList=e.graph.linkList,this.nodeData=e.data,this.dialog=!1,this.importtext=""},handleClose:function(e){var t=this;this.$confirm("确认关闭？").then((function(n){t.isForceSelectEdgeNode=!1,t.mapper_needed=!1,t.tmpschema={},t.tmpdata={node:"",nodeStrategy:{isGPU:!1,nodeArea:"",isNodeRandom:!1,nodeType:"random",nodePrefer:""},nodeAffinity:""},t.tmpnodename="",e()})).catch((function(e){}))},innerHandleClose:function(e){this.$confirm("确认关闭？").then((function(t){e()})).catch((function(e){}))},nodeCombination:function(){this.innerDrawer=!0,console.log(this.node_info)},nodeFilter:function(e,t,n,a){return"edge"===t?(e=this.nodeTypeFilter(e,"边缘端"),e=this.nodeAreaFilter(e,n)):"cloud"===t&&(e=this.nodeTypeFilter(e,"云端"),e=this.nodeGPUFilter(e,a)),e},nodeTypeFilter:function(e,t){var n=[];Object.keys(e).forEach((function(t){var a={};a=Object.assign({key:t},e[t]),n.push(a)}));for(var a=[],o=0;o<n.length;o++)if(n[o].tag.length>0)for(var i=0;i<n[o].tag.length;i++)n[o].tag[i]===t&&a.push(n[o]);return a},nodeAreaFilter:function(e,t){var n=[];Object.keys(e).forEach((function(t){var a={};a=Object.assign({key:t},e[t]),n.push(a)}));for(var a=[],o=0;o<n.length;o++)n[o].tag.length>0&&n[o].area===t&&a.push(n[o]);return a},nodeGPUFilter:function(e,t){var n="";n=t?"GPU":"CPU";var a=[];Object.keys(e).forEach((function(t){var n={};n=Object.assign({key:t},e[t]),a.push(n)}));for(var o=[],i=0;i<a.length;i++)if(a[i].tag.length>0)for(var s=0;s<a[i].tag.length;s++)a[i].tag[s]===n&&o.push(a[i]);return o},openConfig:function(e){var t={node:"",nodeStrategy:{isGPU:!1,nodeArea:"",isNodeRandom:!1,nodeType:"random",nodePrefer:""},nodeAffinity:""};this.tmpnodename=e.id;var n=this.nodesettings[e.meta.id];if(this.tmpschema=this.nodesettings[e.meta.id].schema,"start"===n.prop){this.isForceSelectEdgeNode=!0,this.mapper_needed=!0,this.tmp_mapper_info=this.mapper_info[e.meta.id],t.mapper={};var a=t.mapper;for(var o in this.tmp_mapper_info)a[this.tmp_mapper_info[o].key]={type:"",value:""}}else this.mapper_needed=!1;if(e.id in this.nodeData)for(var i in this.nodeData[e.id])t[i]=this.nodeData[e.id][i];else for(var s in this.tmpschema)"input"===this.tmpschema[s].type?t[s]="":t[s]=this.tmpschema[s].value;this.tmpdata=t,this.drawer=!0},save:function(){for(var e in this.tmpdata["nodeAffinity"]=Object(c["a"])(this.tmpdata.nodeStrategy,this.tmpdata.node),null===this.tmpdata["nodeAffinity"]&&this.$message.error("节点编排无效！"),this.nodeData[this.tmpnodename]={},console.log(JSON.stringify(this.tmpdata)),this.tmpdata)this.nodeData[this.tmpnodename][e]=this.tmpdata[e];this.isForceSelectEdgeNode=!1,this.tmpschema={},this.mapper_needed=!1,this.tmpdata={node:"",nodeStrategy:{isGPU:!1,nodeArea:"",isNodeRandom:!1,nodeType:"random",nodePrefer:""},nodeAffinity:""},console.log(this.tmpdata),this.tmpnodename="",this.drawer=!1},saveNodeCombination:function(){this.innerDrawer=!1},enterIntercept:function(e,t,n){console.log();var a=n.linkList.filter((function(t){return t.start.id===e.id})),o=n.linkList.filter((function(e){return e._end.id===t.id})),i=n.linkList.filter((function(n){return n._end.id===t.id&&n.start.id===e.id}));if(console.log("出发节点",a.length,"接收节点",o.length,"重复节点",i.length,"最大输出",this.nodesettings[e.meta.id].max_output,"最大输入",this.nodesettings[t.meta.id].max_input),i.length>=1)return!1;if(-1===this.nodesettings[e.meta.id].max_output)return!0;if(a.length>=this.nodesettings[e.meta.id].max_output)return!1;if(-1===this.nodesettings[t.meta.id].max_input)return!0;if(o.length>=this.nodesettings[t.meta.id].max_input)return!1;var s=this.nodesettings[e.meta.id].prop;switch(this.nodesettings[t.meta.id].prop){case"start":return!1;case"process":return["start","model","process","fork"].includes(s);case"model":return["start","process","model","fork"].includes(s);case"output":return["start","model","process","fork"].includes(s);case"fork":return["start","model","process","fork"].includes(s);default:return!0}},outputIntercept:function(e,t){return!("output"===this.nodesettings[e.meta.id].prop)},exportJson:function(){var e=this,t={graph:this.$refs.superFlow.toJSON(),data:this.nodeData};console.log(t),this.$confirm("确认提交部署？").then((function(n){var a=e.$loading({fullscreen:!0});Object(d["o"])({definition:JSON.stringify(t),name:e.task_desc.name,description:e.task_desc.desc}).then((function(t){a.close(),200===t.data.code?(e.$message({message:"部署成功",type:"success"}),e.active+=1):e.$message({messgae:t.data.msg,type:"error"})})).catch((function(t){e.$message({messgae:t,type:"error"})}))})).catch((function(e){}))},docMousemove:function(e){var t=e.clientX,n=e.clientY,a=this.dragConf;a.isMove?(a.ele.style.top=n-a.offsetTop+"px",a.ele.style.left=t-a.offsetLeft+"px"):a.isDown&&(a.isMove=Math.abs(t-a.clientX)>5||Math.abs(n-a.clientY)>5)},docMouseup:function(e){var t=e.clientX,n=e.clientY,a=this.dragConf;if(a.isDown=!1,a.isMove){var o=this.$refs.flowContainer.getBoundingClientRect(),i=o.top,r=o.right,l=o.bottom,d=o.left;if(t>d&&t<r&&n>i&&n<l){var c=this.$refs.superFlow.getMouseCoordinate(t-a.offsetLeft,n-a.offsetTop);this.$refs.superFlow.addNode(Object(s["a"])({coordinate:c},a.info))}a.isMove=!1}a.ele&&(a.ele.remove(),a.ele=null)},nodeItemMouseDown:function(e,t){var n=this,a=e.clientX,o=e.clientY,i=e.currentTarget,s=e.currentTarget.getBoundingClientRect(),r=s.top,l=s.left,d=this.dragConf,c=i.cloneNode(!0),p=t();console.log(p),console.log(this.$refs.superFlow.graph.nodeList.find((function(e){return"start"===n.nodesettings[e.meta.id].prop}))),"output"===this.nodesettings[p.meta.id].prop&&this.$refs.superFlow.graph.nodeList.find((function(e){return"output"===n.nodesettings[e.meta.id].prop}))||(Object.assign(this.dragConf,{offsetLeft:a-l,offsetTop:o-r,clientX:a,clientY:o,info:p,ele:c,isDown:!0}),c.style.position="fixed",c.style.margin="0",c.style.top=o-d.offsetTop+"px",c.style.left=a-d.offsetLeft+"px",this.$el.appendChild(this.dragConf.ele))}}},u=p,m=(n("6178"),n("2877")),f=Object(m["a"])(u,a,o,!1,null,null,null);t["default"]=f.exports},cd5a:function(e,t,n){}}]);